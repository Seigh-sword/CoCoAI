<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoCo AI | Multimodal</title>
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/Seigh-sword/Free-AI-For-All/refs/heads/main/assets/CoCoAiIcon.png">

    <style>
        :root { --coco-brown: #3e2723; --coco-accent: #8bc34a; --coco-dark: #121212; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--coco-dark); color: white; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        header { padding: 15px 25px; background: var(--coco-brown); display: flex; align-items: center; gap: 15px; border-bottom: 2px solid var(--coco-accent); }
        .logo { width: 40px; height: 40px; border-radius: 50%; }
        #chat { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .msg { padding: 12px 18px; border-radius: 15px; max-width: 80%; line-height: 1.5; animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .user { align-self: flex-end; background: var(--coco-accent); color: black; }
        .ai { align-self: flex-start; background: #2c2c2c; display: flex; gap: 10px; }
        .ai-icon { width: 22px; height: 22px; border-radius: 50%; }
        .bar { padding: 20px; background: #1e1e1e; display: flex; gap: 10px; align-items: center; }
        input { flex: 1; padding: 12px; border-radius: 25px; border: none; outline: none; background: #333; color: white; }
        button { background: var(--coco-accent); color: black; border: none; padding: 10px 20px; border-radius: 25px; font-weight: bold; cursor: pointer; }
        .status-indicator { font-size: 0.8em; color: #888; margin-left: auto; display: flex; align-items: center; gap: 5px; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background: grey; animation: none; }
        .status-dot.active { background: var(--coco-accent); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0px var(--coco-accent); } 100% { box-shadow: 0 0 0 8px rgba(139, 195, 74, 0); } }
        .ai-image { max-width: 100%; border-radius: 8px; margin-top: 5px; }
    </style>
</head>
<body>

    <header>
        <img src="https://raw.githubusercontent.com/Seigh-sword/Free-AI-For-All/refs/heads/main/assets/CoCoAiIcon.png" class="logo">
        <div>
            <strong>CoCo AI</strong>
        </div>
        <div class="status-indicator">
            <span id="statusText">Ready</span>
            <span class="status-dot" id="statusDot"></span>
        </div>
    </header>

    <div id="chat">
        <div class="msg ai"><img src="https://raw.githubusercontent.com/Seigh-sword/Free-AI-For-All/refs/heads/main/assets/CoCoAiIcon.png" class="ai-icon"><span>How can I help you today? Try "/image a cute coconut"</span></div>
    </div>

    <div class="bar">
        <input type="text" id="in" placeholder="Ask CoCo (e.g., '/image a coconut on a beach' or 'Tell me a joke')">
        <button id="btn">Send</button>
    </div>

    <script type="module">
        import { AIHandler } from './AIHandler/AIHandler.js'; // Adjust path if needed
        
        const coco = new AIHandler();
        const chat = document.getElementById('chat');
        const input = document.getElementById('in');
        const btn = document.getElementById('btn');
        const statusText = document.getElementById('statusText');
        const statusDot = document.getElementById('statusDot');

        function setStatus(text, isActive) {
            statusText.innerText = text;
            if (isActive) {
                statusDot.classList.add('active');
            } else {
                statusDot.classList.remove('active');
            }
        }

        async function handleSend() {
            const val = input.value.trim();
            if(!val) return;

            addMessage('user', val);
            input.value = "";
            setStatus('Thinking...', true); // Set status to thinking

            try {
                let response;
                // Check if it's an image command
                if (val.startsWith('/image ')) {
                    const imgPrompt = val.substring(7); // Remove "/image "
                    response = await coco.img.prompt(imgPrompt)
                                        .set.model(coco.models.image.flux) // Use flux for fast images
                                        .generate();
                    addMessage('ai', response, 'image'); // Pass 'image' type for display
                } else {
                    // Default to text generation with OpenAI
                    response = await coco.txt.prompt(val)
                                        .set.model(coco.models.text.openai)
                                        .generate();
                    addMessage('ai', response, 'text');
                }
            } catch (error) {
                console.error("CoCo UI Error:", error);
                addMessage('ai', `ðŸ¥¥ CoCo encountered an error: ${error.message}`, 'text');
            } finally {
                setStatus('Ready', false); // Reset status
            }
            
            chat.scrollTop = chat.scrollHeight;
        }

        function addMessage(sender, content, type) {
            const div = document.createElement('div');
            div.className = `msg ${sender}`;

            if (sender === 'ai') {
                if (type === 'image') {
                    div.innerHTML = `<img src="https://raw.githubusercontent.com/Seigh-sword/Free-AI-For-All/refs/heads/main/assets/CoCoAiIcon.png" class="ai-icon"><div><img src="${content}" class="ai-image" alt="Generated by CoCo AI"></div>`;
                } else {
                    div.innerHTML = `<img src="https://raw.githubusercontent.com/Seigh-sword/Free-AI-For-All/refs/heads/main/assets/CoCoAiIcon.png" class="ai-icon"><span>${content}</span>`;
                }
            } else {
                div.innerText = content;
            }
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
        }

        btn.addEventListener('click', handleSend);
        input.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleSend(); });
        
        // Initial status
        setStatus('Ready', false); 
    </script>
</body>
</html>
